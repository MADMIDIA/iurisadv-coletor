extends head 
block head
    title Pesquisa

prepend header
    -currentPage = "search"

block printpageinfo
    ul
        p Resultados da pesquisa por: "!{q || ""}" (Página !{page+1} de !{pages} páginas)
        p Filtros aplicados:
        for filter in Object.keys(filters)
            li
                b !{filter}: 
                | !{filters[filter]}



append form
    .d-flex.flex-row.my-2.justify-content-center.align-items-center
        button.btn.w-100(type="submit", formaction=`./stats?q=${q || ""}`): u Ver estatísticas da pesquisa

block main
    if hits.length == 0
        .alert.alert-info(role="alert")
            h4.alert-heading Sem resultados...
            strong
                i.bi.bi-lightbulb-fill
                | Sugestões:
            ol
                li Verifique os filtros utilizados (tribunais, relator, descritores, data)
                li Verifique o termo pesquisado
    else
        article.row.pt-2.sticky-top.bg-white
            .col-4.d-none.d-lg-block: h4.mt-2 !{body.hits.total.value} Resultados:
            .col-12.col-lg-8
                nav.mt-2
                    ul.pagination.justify-content-center.text-center
                        li.page-item.w-100(class=sort=="score"?"active":"")
                            a.page-link(href=`./?sort=score&page=${page}&${querystring}`)
                                i.bi.bi-list-stars
                                span.ps-2 Por Relevância
                        li.page-item.w-100(class=sort=="des"?"active":"")
                            a.page-link(href=`./?sort=des&page=${page}&${querystring}`)
                                i.bi.bi-calendar
                                span.ps-2 Por Data Descendente
                        li.page-item.w-100(class=sort=="asc"?"active":"")
                            a.page-link(href=`./?sort=asc&page=${page}&${querystring}`)
                                i.bi.bi-calendar
                                span.ps-2 Por Data Ascendente
                nav.mt-2
                    ul.pagination.justify-content-center.text-center
                        li.page-item.w-25
                            a.page-link(href=`?page=${0}&sort=${sort}&${querystring}`): i.bi.bi-chevron-double-left
                        li.page-item.w-25
                            a.page-link(href=`?page=${page-1}&sort=${sort}&${querystring}`): i.bi.bi-chevron-left
                        li.page-item.w-100
                            a.page-link(href=`?page=${page}&sort=${sort}&${querystring}`) Página !{page+1}/!{pages}
                        li.page-item.w-25
                            a.page-link(href=`?page=${page+1}&sort=${sort}&${querystring}`): i.bi.bi-chevron-right
                        li.page-item.w-25
                            a.page-link(href=`?page=${pages-1}&sort=${sort}&${querystring}`): i.bi.bi-chevron-double-right
        for doc in hits
            article.row(data-tribunal=doc._source.Tribunal)
                .col-12.pt-2
                    a(href=`./${doc._source.ECLI}`, target="_blank", style="color: var(--tribunal-color);").text-decoration-none !{doc._source.ECLI}
                .col-12.d-flex.flex-wrap.my-1
                    div.mx-1
                        b Tribunal:&nbsp;
                        span #{doc._source.Tribunal}&nbsp;
                        if doc._source.Secção
                            span (#{doc._source.Secção})
                    div.mx-1
                        b Relator:&nbsp;
                        span #{doc._source.Relator}
                    div.mx-1
                        b Data(s):&nbsp;
                        span #{doc.fields.Data}
                .col-12.d-flex.flex-wrap.my-1
                    if doc._source.Espécie
                        div.mx-1
                            b Espécie:&nbsp;
                            span #{doc._source.Espécie}
                    if doc._source["Meio Processual"]
                        div.mx-1
                            b Meio Processual:&nbsp;
                            span #{doc._source["Meio Processual"]}
                if Array.isArray(doc._source.Descritores)
                    .col-12.my-1
                        div.mx-1
                            b Descritores:&nbsp;
                            span #{doc._source.Descritores.join(' / ')}
                if doc._source.Votação
                    .col-12.my-1
                        div.mx-1
                            b Votação:&nbsp;
                            span #{doc._source.Votação}
                if doc._source.Decisão
                    .col-12.my-1
                        div.mx-1.d-flex
                            b Decisão:&nbsp;
                            div !{doc._source.Decisão}
                if doc._source.Sumário
                    details.col-12.my-1
                        summary.mx-1: b.mouse-click Sumário:
                        div.col-12 !{doc._source["Sumário"]}
    script.
        // Close all summary elements
        function closeAllSummaries() {
            var allSummaries = document.getElementsByTagName('summary');
            for (var i = 0; i < allSummaries.length; i++) {
                allSummaries[i].parentNode.removeAttribute('open');
            }
        }
        // Open all summary elements
        function openAllSummaries() {
            var allSummaries = document.getElementsByTagName('summary');
            for (var i = 0; i < allSummaries.length; i++) {
                allSummaries[i].parentNode.setAttribute('open', true);
            }
        }
        addEventListener('beforeprint', openAllSummaries);
        addEventListener('afterprint', closeAllSummaries);
    style.
        @media print{
            article[data-tribunal] {
                max-height: none !important;
                width: 100%;
                display: block;
            }

            article[data-tribunal]::after{
                top:100% !important;
            }

            article{
                break-inside: avoid !important;
            }
            nav{ display: none; }
        }

        article[data-tribunal] {
            position: relative;
            /*max-height: 300px;*/
            overflow: hidden;
            transition: 0.5s 0.3s;
            padding-bottom: 15px;
            margin-bottom: 10px;
        }

        /*article[data-tribunal]:focus-within, article[data-tribunal]:hover {
            max-height: 1000px;
        }*/

        article[data-tribunal]::before {
            content: '';
            background: var(--tribunal-color);
            top: 5px;
            width: 5px;
            position: absolute;
            border-radius: 10px;
            bottom: 30px;
        }
        article[data-tribunal]::after {
            /*content: "";*/
            position: absolute; 
            top: 50%;
            bottom: 0;
            left: -15px;
            right: -15px;
            box-shadow: inset white 0 -45px 20px;
            transition: 0.5s 0.3s;
        }

        article[data-tribunal]:focus-within::after, article[data-tribunal]:hover::after{
            box-shadow: inset white 0 0px 0px;
        }
