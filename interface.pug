// interface.pug - VERSÃO FINAL COM BOTÃO DE IMPORTAÇÃO

doctype html
html(lang="pt-BR")
  head
    title iurisadv.ai - Pesquisa Jurisprudencial
    style.
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 2em; background-color: #f4f4f9; color: #333; }
      .container { max-width: 900px; margin: auto; background-color: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
      h1 { color: #2c3e50; }
      .search-bar form { display: flex; gap: 10px; }
      .search-bar input { flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em; }
      .search-bar button { padding: 12px 20px; border: none; background-color: #3498db; color: white; border-radius: 4px; font-size: 1em; cursor: pointer; }
      .result-item { border-top: 1px solid #eee; padding: 1.5em 0; }
      h3 a { text-decoration: none; color: #3498db; }
      .meta { font-size: 0.8em; color: #888; margin-top: 1em; }
      .error-message, .import-message { padding: 1em; border-radius: 4px; margin: 2em 0; }
      .error-message { background-color: #fbeae5; color: #c0392b; }
      .import-message { background-color: #e8f4fd; color: #2980b9; }
      .import-message a { color: #fff; background-color: #2980b9; padding: 10px 15px; border-radius: 4px; text-decoration: none; }

  body
    div.container
      h1 iurisadv.ai
      p Pesquisa Inteligente de Jurisprudência
      div.search-bar
        form(action="/", method="GET")
          input(type="text", name="q", placeholder="Digite sua busca...", value=query)
          button(type="submit") Pesquisar
      
      // --- LÓGICA DE EXIBIÇÃO MELHORADA ---
      if needs_import
        div.import-message
          p #[strong= error]
          p Clique no botão abaixo para carregar os dados iniciais.
          a(href="/import") Importar Dados Agora
      else if error
        div.error-message
          p= error
      else
        div.results-info
          p #[strong= total] resultados encontrados.
      
      each result in results
        div.result-item
          h3 
            a(href=result.link, target="_blank")= result.titulo
          p= result.ementa || result.sumario
          p.meta Fonte: #{result.fonte} | Data: #{result.data_julgamento || result.data}